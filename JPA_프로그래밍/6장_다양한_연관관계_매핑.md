# 6.1 다대일

- 양방향은 외래 키가 있는 쪽이 연관 관계의 주인이다.
- 양방향 연관관계는 항상 서로를 참조해야 한다.

# 6.2 일대다

### 일대다 단방향 매핑의 단점

매핑한 객체가 관리하는 외래 키가 다른 테이블에 있다.

다른 테이블에 외래 키가 있으면 연관관계 처리를 위해 update sql을 추가로 실행해야 한다.

### 일대다 단방향 매핑보다는 다대일 양방향 매핑을 사용하자

- 외래키를 가진쪽이 연관관계의 주인이라고 했는데 일대다 단방향 매핑에선 연관관계의 주인은?
    - 일(One)이 연관관계 주인
    - 하지만 외래키는 다(Many)에서 가지고 있음

## 6.2.2 일대다 양방향

관계형 데이터 베이스의 특성상 일대다, 다대일 관계는 항상 다 쪽에 외래 키가 있다.

따라서 양방향 매핑에서 연관관계의 주인은 항상 다 쪽인 @ManyToOne을 사용한 곳이다.

따라서 ManyToOne에는 mappedby속성이 없다.

# 6.3 일대일

## 6.3.1 주 테이블에 외래 키

주 객체가 대상 객체를 참조하는 것처럼 주 테이블에 외래 키를 두고 대상 테이블을 참조

외래 키를 객체 참조와 비슷하게 사용할 수 있어 객체지향 개발자들이 선호

주 테이블이 외래 키를 가지고 있으므로 주 테이블만 확인해도 대상 테이블과 연관관계가 있는지 알 수 있다.

## 6.3.2 대상 테이블에 외래 키

데이터베이스 개발자들이 선호하는 방식

테이블 관계를 일대일에서 일대다로 변경할 때 테이블 구조를 그대로 유지할 수 있다.

### 단방향

JPA에서 지원하지 않기 때문에, 양방향 관계에서 대상 테이블을 연관관계의  주인으로 설정해야 한다.

# 6.4 다대다

관계형 데이터베이스는 정규화된 테이블 2개로 다대다 관계를 표현할 수 없다.

따라서 연결 테이블을 사용하게 된다.

## 6.4.3 다대다: 매핑의 한계와 극복, 연결 엔티티 사용

보통은 연결 테이블에 추가 컬럼이 필요하다.

@IdClass를 사용하여 복합 기본 키 매핑

### 복합 기본 키

JPA에서 복합 키를 사용하려면 별도의 식별자 클래스를 만들어야 한다.

- Serializable을 구현해야 한다
- equals와 hashCode 메소드를 구현해야 한다.
- 기본 생성자가 있어야 한다.
- 식별자 클래스는 public 이어야 한다.
- @IdClass와 @EmbeddedId를 사용하는 방법이 있다.

### 식별 관계

부모 테이블의 기본 키를 받아서 자신의 기본 키 + 외래 키로 사용하는 것을 식별 관계라고 한다.

## 6.4.4 다대다: 새로운 기본 키 사용

복합 키를 사용하는 방법은 복잡하기 때문에 대리 키를 사용하는 법을 추천한다.

간편하고 영구히 쓸 수 있으며 비즈니스에 의존하지 않는다. 또한 ORM 매핑 시에 복합 키를 만들지 않아도 된다.

비식별 관계라고 한다.
