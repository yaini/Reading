# downward API

파드의 실행 후 알 수 있는 데이터(파드 IP, 호스트 노드)들을 제공하기 위한 쿠버네티스 API

환경변수 또는 파일로 파드와 해당 환경의 메타데이터가 저장되도록 하는 방식

### 메타 데이터를 제공하는 방법

- 환경변수
- 볼륨을 이용한 파일
    - 레이블과 어노테이션은 실행 중에도 바뀔 수 있기 때문에 이를 업데이트하기 위해 파일을 이용한 방법을 사용해야 한다.

## 쿠버네티스 API와 통신

서비스와 파드에 관한 정보는 서비스 관련 환경변수나 DNS로 얻을 수 있다. 하지만 다른 리소스의 정보가 필요하거나 최신 정보에 접근해야 하는 경우 API 서버와 직접 통신해야 한다.

- downward api: 파드 자체의 메타데이터, 모든 파드의 데이터 중 일부
- 쿠버네티스 api: 클러스터에 정의된 다른 파드나 리소스에 관한 더 많은 정보

### 로컬에서 통신

kubectl을 통해 프록시로 API 서버 엑세스 가능

### 파드 내에서 통신

- API 서버 위치 찾기
    - KUBERNETES_SERVICE 환경변수 확인
    - [https://kubernetes](https://kubernetes) 접속
- API 서버와 통신하고 있는지 확인
- API 서버로 인증
    - 시크릿이 마운트된 볼륨에서 인증서와 토큰을 이용하여 서버와 인증
    - 시크릿의 네임스페이스를 이용하여 CRUD 작업 수행

### 앰배서더 컨테이너를 통한 통신

http로 앰배서더에 연결하고, 앰배서더 프록시가 API 서버에 대한 HTTPS 연결을 처리

추가 프로세스와 리소스를 소비한다는 단점이 있다.

### 클라이언트 라이브러리를 사용한 API 통신

Java는 Fabric8 사용
