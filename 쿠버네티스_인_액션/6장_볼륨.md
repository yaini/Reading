각 컨테이너들은 고유의 파일 시스템을 가지며, 시작될 때마다 새로운 파일 시스템을 생성한다.

쿠버네티스는 데이터를 가진 디렉토리를 보존하기 위해 스토지리 볼륨을 제공한다.

파드와 같은 최상위 리소스는 아니지만 파드의 일부분으로 정의되며 파드와 동일한 라이프사이클을 가진다. 

파드가 여러 개의 컨테이너를 가진 경우 컨테이너 간의 볼륨 공유가 가능하다.

# 볼륨

- 파드의 구성요소, 파드 스펙에서 정의
- 독립적인 쿠버네티스 오브젝트가 아니므로 자체 생성, 삭제 불가능
- 컨테이너에서 접근하기 위해서 마운트 되어야 함

## 컨테이너 간의 데이터 공유

### emptyDir

빈 디렉터리로 시작하는 볼륨

동일 파드에서 실행 중인 컨테이너 간 파일을 공유할 때 유용

임시 데이터를 디스크에 쓸 경우도 사용

medium을 통해 매체 지정 *ex) Memory*

### gitRepo

기본적으로 emptyDir 볼륨

파드가 시작되면 깃 레포를 복제하고 특정 리비전을 체크아웃해 데이터로 채움

레포지토리와 동기화 되지 않음

파드를 위해 특별히 생성되고 독점적으로 사용되는 전용 디렉토리

- 동기화를 위해 고려해야 할 사항
    - 사이드카 컨테이너
        - 깃 동기화 프로세스가 웹 서버와 동일 컨테이너에서 실행되면 안되며 사이드카 컨테이너에서 실행되어야 함
        - 도커 허브 git sync 이미지들 참조
    - private git Repository
        - 깃 동기화 사이드카 혹은 git Repo 볼륨을 대신하는 방법을 사용해야 함

## 워커 노드 파일 시스템의 파일 접근

대부분의 하드는 호스트 노드를 인식하지 못하므로 노드의 파일 시스템에 접근할 수 없음

특정 시스템 레벨의 파드는 노드의 파일을 읽거나 파일 시스템을 통해 노드 디바이스에 접근하기 위해 노드 파일 시스템을 사용해야 한다.

이를 쿠버네티스에선 hostPath를 통해 제공

### hostPath

퍼시스턴트 스토리지 중 하나

노드 파일 시스템의 특정 파일이나 디렉토리를 가리킴

워커 노드의 특정 파일이나 디렉토리를 컨테이너의 파일 시스템에 마운트

파드가 종료되어도 삭제되지 않는다. 하지만 다른 노드로 스케쥴링 시 접근이 불가능 하므로 주의해야 한다.

일반적인 파드엔 사용하지 않는다. *ex) statefulSet에서 사용*

보통 노드의 로그파일, kubeconfig, CA 인증서를 저장 하는데에 쓰임

## 퍼시스턴트 스토리지 사용

다른 노드에 스케쥴링 시에도 영구적인 데이터를 유지하려면 NAS유형에 저장되어야 한다.

### GCE 퍼시스턴트 디스크

클러스터가 실행중인 기반 인프라 스트럭처에 따라 볼륨 유형을 정해야 한다.

구글 쿠버네티스 엔진에서 클러스터가 실행 중이기 때문에 GCE 퍼시스턴트 디스크 볼륨 생성

## 기반 스토리지 기술과 파드 분리

개발자가 인프라스트럭처의 세부 사항에 대해 알 필요가 없이 어플리케이션을 만들고 프로비저닝할 수 있어야 한다.

### 퍼시스턴트 볼륨 / 퍼시스턴트 볼륨 클레임 작동 방식

클러스터 관리자가 기반 스토리지를 설정하고 퍼시스턴트 볼륨을 생성하여 쿠버네티스에 등록한다.

클러스터 사용자는 크기와 접근 모드를 명시하여 퍼시스턴트 볼륨 클레임 메니페스트를 생성한다.

클러스터 사용자가 퍼시스턴트볼륨클레임 메니페스트를 쿠버네티스 API에 게시한다.

쿠버네티스는 적절한 퍼시스턴트 볼륨을 찾아 클레임에 볼륨을 바인딩한다.

퍼시스턴트 볼륨 클레임은 파드 내부의 볼륨 중 하나로 사용된다.

### 퍼시스턴트 볼륨

클러스터 수준의 리소스이므로 특정 네임스페이스에 생성 불가능

동일한 네임스페이스의 파드에서만 사용

리클레임 정책: Retain, Recycle, Delete

## 퍼시스턴트 볼륨의 동적 프로비저닝

클러스터 관리자가 퍼시스턴트 볼륨을 생성하는 대신 퍼시스턴트볼륨 프로비저너를 배포하고 사용자가 각 타입의 스토리지 클래스 오브젝트로 정의
