## 인플레이스 배포

기존 파드를 모두 삭제한 후, 새로운 파드 실행

레플리케이션 컨트롤러의 파드 템플릿을 수정

새 파드가 시작되는 동안 짧은 시간의 다운타임이 있다

## 블루 그린 배포

새 파드를 모두 기동한 후 이전 파드 삭제, 동시에 여러 버전의 파드가 실행되므로 더 많은 하드웨어 리소스 사용

서비스의 레이블 셀렉터를 변경

파드 전환 후 이전 버전의 레플리케이션 컨트롤러를 삭제

## 롤링 배포

파드를 단계별로 업데이트

기존 레플리케이션과 새로운 레플리케이션을 정의한 후 rolling-update 명령어 실행

### rolling-update 단점

- 파드의  레이블과 레플리케이션 컨트롤러를 쿠버네티스가 수정
- 롤링 업데이트를 수행하는 주체가 kubectl 클라이언트

## 카나리 배포

새 버전을 모두 롤아웃하는 대신 적은 수의 이전 파드만 새 버전으로 변경

새 버전이 정상적으로 작동하는 것을 확인한 후 모든 파드 롤아웃

# 디플로이먼트

```bash
디플로이먼트 -> 레플리카셋 -> 파드
```

어플리케이션을 배포하고 선언적으로 업데이트하기 위한 높은 수준의 리소스

실제 파드는 디플로이먼트의 레플리카셋에 의해 생성되고 관리됨

## 생성

레이블 셀렉터, 원하는 레플리카 수, 파드 템플릿으로 구성, 디플로이먼트 전략 지정

디플로이먼트는 여러 개의 파드 버전을 실행할 수 있으므로 이름에 버전을 포함할 필요가 없다.

디플로이먼트를 통해 생성한 파드와 레플리카셋에는 파드 템플릿의 해시값을 가지고 있다.

## 업데이트

### recreate

디플로이먼트의 인플레이스 배포 전략

### rollingupdate

디플로이먼트의 롤링 배포 전략

파드 템플릿 이미지만 변경하면 디플로이먼트 컨트롤러가 자동으로 배포해준다.

기존의 레플리카셋은 삭제되지 않는다.

## 롤백

디플로이먼트는 개정 이력을 유지하므로 undo 명령어를 통해 특정 버전으로 롤아웃의 롤백이 가능하다.

## 롤아웃 속도 제어

### maxSurge

디플로이먼트가 의도하는 레플리카 수보다 얼마나 많은 파드 인스턴스 수를 허용할 수 있는지 제어

디폴트는 25%, 의도한 개수보다 최대 25% 많은 파드 인스턴스가 있을 수 있다는 의미

### maxUnavailable

업데이트 중에 의도하는 레플리카 수를 기준으로 사용할 수 없는 파드 인스턴스 수를 결정

디폴트는 25%

## 중지

롤아웃 일시 정지를 통해 카나리 릴리즈 실행이 가능하다.

## 잘못된 버전 롤아웃 방지

### minReadySeconds

파드를 사용 가능한 것으로 취급하기 전에 새로 만든 파드를 준비할 시간을 지정

## 데드라인

디폴트로 롤아웃이 10분 동안 진행되지 않으면 실패한 것으로 간주

progressDeadlineSeconds 로 지정 가능
