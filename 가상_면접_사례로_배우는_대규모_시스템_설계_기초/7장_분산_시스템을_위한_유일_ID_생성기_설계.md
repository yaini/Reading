관계형 데이터베이스의 auto_increment는 데이터베이스 서버 한 대로 그 요구를 감당할 수 없을 뿐더러, 여러 데이터베이스 서버를 쓰는 경우 지연 시간을 낮추기가 힘들다.

# 1단계. 문제 이해 및 설계 범위 확정

# 2단계. 개략적 설계안 제시 및 동의 구하기

## 분산 시스템에서 유일성이 보장되는 ID를 만드는 방법

### 다중 마스터 복제

데이터 베이스 서버의 수를 k로 두고 k만큼 auto_increment 기능을 활용

**단점**

- 여러 데이터 센터에 걸쳐 규모를 늘리기 어려움
- ID의 유일성은 보장되지만 그 값이 시간 흐름에 맞추어 커지도록 보장할 수 없음
- 서버를 추가하거나 삭제할 때도 잘 동작하도록 만들기 어렵다.

### UUID

컴퓨터 시스템에 저장되는 정보를 유일하게 식별하기 위한 128비트 짜리 수

충돌 가능성이 지극히 낮다

독립적으로 생성 가능

**장점**

- 생성이 단순하며 동기화 이슈가 없다
- 규모 확장이 쉽다

**단점**

- ID가 128비트로 길다
- 시간순으로 정렬할 수 없다.
- 숫자 아닌 값이 포함될 수 있다.

### 티겟 서버

auto_increment 기능을 갖춘 데이터베이스 서버, 즉 티켓 서버를 중앙 집중형으로 하나만 사용

**장점**

- 유일성이 보장되는 숫자로만 구성된 ID를 만들 수 있음
- 구현하기 쉽고, 중소 규모 어플리케이션에 적합

**단점**

- 티켓 서버가 SPOF가 된다.

### 트위터 스노플레이크 접근법

64비트 ID를 사인 비트, 타임스탬프, 데이터 센터 ID, 서버 ID, 일련번호로 나누어 생성

# 3단계. 상세 설계

타임 스탬프와 일련번호는 ID 생성기 작동 중에 만들어지는 값

### 타임스탬프

시간에 따라 점점 큰 값을 가지므로 정렬 가능

### 일련 번호

어떤 서버가 같은 밀리초 동안 하나 이상의 ID를 만들어 낸 경우에만 0보다 큰 값

# 4단계. 마무리

추가 논의 사항

- 시계 동기화
- 각 절의 길이 최적화
- 고가용성
