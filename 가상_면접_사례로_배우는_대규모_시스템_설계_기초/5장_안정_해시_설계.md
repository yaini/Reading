# 해시 키 재배치 문제

### 서버들에 부하를 균등하게 나누는 보편적 방법

serverIndex = hash(key)%N (N은 서버 개수)

- 서버 풀의 크기가 고정되어 있을때, 데이터 분포가 균등할 때 사용
- 서버가 추가되거나 삭제되면 분포에 문제 발생

# 안정 해시

해시 테이블 크기가 조정될 때 평균적으로 오직 k/n개의 키만 재배치

( k는 키의 개수, n은 슬롯의 개수 )

전통적 해시 테이블은 슬롯의 수가 바뀌면 대부분의 키를 재배치

## 해시 서버

해시 함수 f를 사용하여 해시 링에 배치

## 서버 조회

키가 저장되는 서버는 키의 위치로부터 시계 방향으로 링을 탐색해 나가면서 만나는 첫번째 서버

## 서버 추가

서버를 추가하더라도 키 가운데 일부만 재배치하면 됨

## 서버 제거

키 가운데 일부만 재배치

## 기본 구현법의 두 가지 문제

### 안정 해시 알고리즘의 기본 절차

- 서버와 키를 균등 분포 해시 함수를 사용해 해시 링에 배치
- 키의 위치에서 링을 시계 방향으로 탐색하다 만나는 최초의 서버가 키가 저장될 서버

### 문제점

- 파티션의 크기를 균등하게 유지하는 게 불가능
    - 파티션: 인접한 서버 사이의 해시 공간
- 키의 균등 분포를 달성하기 어려움

## 가상 노드

실제 노드 또는 서버를 가리키는 노드

하나의 서버는 링 위에 여러 개의 가상 노드를 가질 수 있다.

각 서버는 하나가 아닌 여러 개의 파티션을 관리해야 함

# 마치며

### 안정해시의 이점

- 서버가 추가되거나 삭제될 때 재배치되는 키의 수가 최소화
- 데이터가 균등하게 분호되므로 수평적 규모 확장성 달성
- 핫스팟 키 문제를 줄임
