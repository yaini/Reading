# 1단계. 문제 이해 및 설계 범위 확정

### 기본적인 기능

- URL 단축
- URL 리다이렉션
- 높은 가용성과 규모확장성, 장애 감내 요구

# 2단계. 개략적 설계안 제시 및 동의 구하기

## API 엔드포인트

클라이언트는 서버가 제공하는 API 엔드포인트를 통해 서버와 통신한다.

- URL 단축용 엔드포인트
- URL 리다이렉션용 엔드포인트

## URL 리다이렉션

단축 URL을 받은 서버는 그 URL을 원래 URL로 바꾸어 Location 헤더에 넣어 반환

- 301 Permanently Moved: 해당 url에 대한 http 요청의 책임으로 location 헤더의 url로 이전. 브라우저는 이 응답을 캐시한다.
    - 서버 부하를 줄일 때 사용
- 302 Found: 일시적으로 지정
    - 트래픽 분석에 사용

## URL 단축

### 해시 함수 요구사항

- 입력으로 주어지는 긴 URL이 다른 값이면 해시 값도 달라야 함
- 계산된 해시 값은 원래 입력으로 주어졌던 긴 URL로 복원될 수 있어야 함

# 3단계. 상세 설계

## 데이터 모델

관계형 데이터 베이스에 id, shortURL, longURL로 저장

## 해시 함수

### 해시 후 충돌 해소

해시 함수 적용 후 글자 값을 줄이는 법

- 처음 7개의 글자만 이용
    - 해시 결과가 서로 충돌할 확률이 높아짐
    - 충돌이 발생했을 땐 해소될 때까지 사전에 정한 문자열을 해시값에 덧붙임
    - 오버헤드가 큼

### base-62 변환

수의 표현식이 다른 두 시스템이 같은 수를 공유하여야 하는 경우에 유용

수를 표현하기 위해 62개의 문자 사용

- 단축 url의 길이가 가변적
- 유일성 보장 ID 생성기 필요
- 다음 URL을 알아낼 수 있어서 보안상 문제

## URL 단축기 상세 설계

데이터 베이스의 ID는 전역적 유일성이 보장되어야 함

## URL 리다이렉션 상세 설계

쓰기보다 읽기를 더 자주하는 시스템이므로 <단축 url, 원래 url>의 쌍을 캐시에 저장하여 성능을 높임

# 4단계. 마무리

### 더 고려할 사항

- 처리율 제한 장치
- 웹 서버의 규모 확장
- 데이터베이스의 규모 확장
- 데이터 분석 솔루션
- 가용성, 데이터 일관성, 안정성
